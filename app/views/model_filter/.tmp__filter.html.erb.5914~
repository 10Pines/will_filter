<script>
  <!--
	function saveFilter() {
		filter_name = prompt("Please provide the name for the filter:");
		if (filter_name == null) {
			return;
		}

		$("loader_icon").show();
		$("filter_name").value = filter_name;		

		form_hash = $('filter_form').serialize(true);
		
		new Ajax.Updater('filter', '/data_filter/save_filter', {
		  parameters: form_hash,
			onComplete: function(transport) {
				$("loader_icon").hide();
				enableControlButtons();
			} 
		});
	}

	function toggleSQLConditions() {
		$("sql_conditions").toggle();
	}
	
	function changeFilterModel() {
		$("loader_icon").show();
		form_hash = $('filter_form').serialize(true);
		
		$("filter_dirty").show();
		
		form_hash["model_changed"] = true
		
		new Ajax.Updater('filter', '/data_filter/change_filter_model', {
		  parameters: form_hash,
			onComplete: function(transport) {
				$("loader_icon").hide();
				disableControlButtons();
				enableControlButtons();
			} 
		});
		
	}
	
	function updateFilter() {
		filter_name = prompt("Please provide the name for the filter:", $("filter_name").value);
		if (filter_name == null) {
			return;
		}

		$("loader_icon").show();
		$("filter_name").value = filter_name;		

		form_hash = $('filter_form').serialize(true);
		
		new Ajax.Updater('filter', '/data_filter/update_filter', {
		  parameters: form_hash,
			onComplete: function(transport) {
				$("loader_icon").hide();
			} 
		});
	}

	function deleteFilter() {
		if (!confirm("Are you sure you want to delete this filter?")) {
			return;
		}

		$("loader_icon").show();
		form_hash = $('filter_form').serialize(true);
		
		new Ajax.Updater('filter', '/data_filter/delete_filter', {
		  parameters: form_hash,
			onComplete: function(transport) {
				$("loader_icon").hide();
				$('filter_form').submit();
			} 
		});
		
	}
	
	function disableControlButtons() {
		$("filterDeleteBtn").disabled = true;
		$("filterUpdateBtn").disabled = true;
		$("filterSaveAsBtn").disabled = true;
	}

	function enableControlButtons() {
		disableControlButtons();
		
		if ($("filter_id").value != "") {
			$("filterDeleteBtn").disabled = false;
			$("filterUpdateBtn").disabled = false;
		}
		$("filterSaveAsBtn").disabled = false;
	}
	
	function markDirty() {
		if ($("selected_filter_key") && $("filter_id").value == "") {
			$("selected_filter_key").value = "-1";
		}

		disableControlButtons();
		$("filter_dirty").show();
	}
	
	function toggleFilter() {
		if ($("filter_container").style.display == "none") {
			$("filter_container").show();
			$("filter_toggler").innerHTML = "- Filter";
		} else {
			$("filter_container").hide();
			$("filter_toggler").innerHTML = "+ Filter";
		}
	}

	function loadPredefinedFilter() {
		if ($("selected_filter_key").value == "-1" || $("selected_filter_key").value == "-2")
			return

		$("loader_icon").show();
		form_hash = $('filter_form').serialize(true);

		new Ajax.Updater('filter', '/data_filter/load_filter', {
		  parameters: form_hash,
			onComplete: function(transport) {
				$("loader_icon").hide();
				$('filter_form').submit();
			} 
		});
  }
	
	function performFilterAction(action) {
//		form_vals = $('filter_form').serialize();
//		alert(form_vals);
		
		if (action=="submit") {
			$('filter_form').submit();
			return;			
		}

		$("loader_icon").show();

		markDirty();
		
		form_hash = $('filter_form').serialize(true);
		form_hash["filter_action"] = action;
		
		new Ajax.Updater('filter', '/data_filter/update', {
		  parameters: form_hash,
			evalScripts: true,
			onComplete: function(transport) {
				$("loader_icon").hide();
			} 
		});
		
	}
	
	//--> 
</script>

<%= render :partial => '/model_filter/filter_common' %>

<script>
    disableControlButtons();
    <% unless @model_filter.errors? %>
    		enableControlButtons();
    <% end %>
</script>

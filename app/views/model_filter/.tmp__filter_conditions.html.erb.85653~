<input type="hidden" name="<%=DataFilter::HTML_FILTER_ID%>" id="<%=DataFilter::HTML_FILTER_ID%>" value="<%=@filter.id%>">
<input type="hidden" name="<%=DataFilter::HTML_FILTER_NAME%>" id="<%=DataFilter::HTML_FILTER_NAME%>" value="<%=@filter.name%>">

<% unless @filter.is_a?(DynamicFilter) %>
<input type="hidden" name="<%=DataFilter::HTML_MODEL_NAME%>" id="<%=DataFilter::HTML_MODEL_NAME%>" value="<%=@filter.model_class_name%>">
<% end %>

<table width="98%" style="margin-left:5px;">
	<tr>
		<td align="left">
			Match <select name="<%=DataFilter::HTML_FILTER_MATCH_TYPE%>" onChange="markDirty()">
							<option value="all" <%= ('selected' if @filter.match_type=='all') %> >all</option>
							<option value="any" <%= ('selected' if @filter.match_type=='any') %> >any</option>
						</select> of the following 

		<% if @filter.is_a?(DynamicFilter) %>				
	      <%= select_tag DataFilter::HTML_MODEL_NAME, options_for_select(@filter.model_class_names, @filter.model_class_name), {:onChange=>"changeFilterModel()"} %>
		<% else %>				
				<%=@filter.model_class_name %> 
				<input type='hidden' name='<%=DataFilter::HTML_MODEL_NAME%>' value='<%=@filter.model_class_name%>'>
		<% end %>				
		criteria:<br>	
		</td>		
		<td align="right">
			<% if @filter.saved_filters(@own_profile).size > 0 %>
	      <%= select_tag "selected_filter_key", options_for_select(@filter.saved_filters(@own_profile), @filter.selected_filter_key), {:onChange=>"loadPredefinedFilter()"} %>
			<% end %>
		</td>
	</tr>
</table>

<table width="100%" style="margin-top:5px">
<% 
		0.upto(@filter.criteria_size-1) do |index| 
  	 	criteria = @filter.criteria_at(index) 
%>
			<% if @filter.errors[criteria.key] %>
			<tr>
				<td colspan="2">&nbsp;</td>
				<td colspan="2" style="padding-left:5px; padding-bottom:5px; color:red">
					<%= @filter.errors[criteria.key] %>
				</td>
			</tr> 
			<% end %>
			
			<tr>
				<td width="20%" style="padding-left:5px; padding-bottom:5px;">
			    <%= select_tag "#{DataFilter::HTML_FILTER_CRITERIA_PREFIX}_#{index}", options_for_select(@filter.criteria_options, criteria.key), {:style=>"width:100%", :onChange=>"performFilterAction('changedCriteriaAt_#{index}')"} %>
				</td>
				<td width="15%" style="padding-left:5px; padding-bottom:5px;">
			    <%= select_tag "#{DataFilter::HTML_FILTER_OPERATOR_PREFIX}_#{index}", options_for_select(@filter.operator_options(criteria.key), criteria.operator), {:style=>"width:100%", :onChange=>"performFilterAction('update')"} %>
				</td>
				<td width="55%" style="padding-left:5px; padding-bottom:5px;">
					<%= criteria.container.render_html(index) %>
				</td>
				<td width="10%" align="center" style="padding-left:5px; padding-bottom:5px;">
					<input type="button" value="+" onClick="performFilterAction('addCriteriaAfter_<%=index%>')">
					<input type="button" value="-" onClick="performFilterAction('removeCriteriaAt_<%=index%>')">
				</td>
			</tr>
			
	<% end %>
</table>	
